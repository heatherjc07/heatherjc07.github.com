<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Erlang Day 3 &#8211; Heather Campbell's Blog</title>
<meta name="description" content="My experience with day three of exploring Erlang through Seven Languages in Seven Weeks.

">
<meta name="keywords" content="seven languages in seven weeks, erlang, languages">


<!-- Twitter Cards -->
<meta name="twitter:title" content="Erlang Day 3">
<meta name="twitter:description" content="My experience with day three of exploring Erlang through Seven Languages in Seven Weeks.

">
<meta name="twitter:site" content="@hcampbell07">
<meta name="twitter:creator" content="@hcampbell07">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://localhost:4000/images/">

<!-- Open Graph -->
<meta property="og:locale" content="en_GB">
<meta property="og:type" content="article">
<meta property="og:title" content="Erlang Day 3">
<meta property="og:description" content="My experience with day three of exploring Erlang through Seven Languages in Seven Weeks.

">
<meta property="og:url" content="http://localhost:4000/development/erlang-day-3/">
<meta property="og:site_name" content="Heather Campbell's Blog">





<link rel="canonical" href="http://localhost:4000/development/erlang-day-3/">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Heather Campbell's Blog Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="http://localhost:4000/assets/js/vendor/html5shiv.min.js"></script>
  <script src="http://localhost:4000/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>


<!-- MathJax -->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		    <li><a href="http://localhost:4000/about/" >About</a></li>
		  
		    
		    <li><a href="http://localhost:4000/blog/" >Blog</a></li>
		  
		    
		    <li><a href="http://localhost:4000/presentations/" >Presentations</a></li>
		  
		    
		    <li><a href="https://twitter.com/HCampbell07/" target="_blank">Tweets</a></li>
		  
		    
		    <li><a href="http://localhost:4000/search/" >Search</a></li>
		  
		<li><a href="http://localhost:4000/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	<div class="wrap">
      <h1 class="site-title animated fadeIn"><a href="http://localhost:4000/">Heather Campbell's Blog</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">A place to share my thoughts</h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <ul class="entry-tags">
          <li><a href="http://localhost:4000/tags/#seven languages in seven weeks" title="Pages tagged seven languages in seven weeks">seven languages in seven weeks</a></li><li><a href="http://localhost:4000/tags/#erlang" title="Pages tagged erlang">erlang</a></li><li><a href="http://localhost:4000/tags/#languages" title="Pages tagged languages">languages</a></li>
        </ul>
        
          <h1 class="entry-title">Erlang Day 3</h1>
        
      </header>
      <footer class="entry-meta">
        
        
          <img src="http://localhost:4000/images/bio-photo.jpg" class="bio-photo" alt="Heather Campbell bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Heather Campbell</span></span>
        <span class="entry-date date published"><time datetime="2012-11-05T00:00:00+00:00"><i class="fa fa-calendar-o"></i> November 05, 2012</time></span>
        

        <span class="social-share-twitter">
  <a href="https://twitter.com/intent/tweet?hashtags=sevenlanguagesinsevenweeks,erlang,languages&amp;text=Erlang%20Day%203&amp;url=http://localhost:4000/development/erlang-day-3/&amp;via=hcampbell07" title="Share on Twitter" itemprop="Twitter"><i class="fa fa-twitter-square"></i> Tweet</a>
</span>
<span class="social-share-facebook">
  <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/development/erlang-day-3/" title="Share on Facebook" itemprop="Facebook"><i class="fa fa-facebook-square"></i> Like</a>
</span>
<span class="social-share-googleplus">
  <a href="https://plus.google.com/share?url=http://localhost:4000/development/erlang-day-3/" title="Share on Google Plus" itemprop="GooglePlus"><i class="fa fa-google-plus-square"></i> +1</a>
</span>
<!-- /.social-share -->
        
      </footer>
      <div class="entry-content">
        <p><em>My experience with day three of exploring Erlang through <a href="http://pragprog.com/book/btlang/seven-languages-in-seven-weeks" target="_blank">Seven Languages in Seven Weeks</a>.</em></p>

<p>After a couple of days of having to reprogram how I approach problems coming from an OO background I’m looking forwards to tackling the areas that Erlang excels at, concurrency and reliability.</p>

<h2 id="concurrency">Concurrency</h2>

<p>Concurrency in Erlang is build upon three basic primitives</p>

<ul>
  <li><strong>! :</strong> to send a message</li>
  <li><strong>spawn :</strong> to spawn a process</li>
  <li><strong>receive:</strong> to receive a message</li>
</ul>

<p>Lets start with a basic example where we create a function which receives a message from another process and displays the appropriate information based on the format of the message which was passed.</p>

<noscript><pre>400: Invalid request
</pre></noscript>
<script src="https://gist.github.com/5554054.js?file=buy.erl"> </script>

<p>If it receives a message of a finished atom it displays that the purchases have been completed and terminates.</p>

<p>If it receives a purchase atom it display the item and quantity which have been purchased and waits for the next purchase message.</p>

<noscript><pre>400: Invalid request
</pre></noscript>
<script src="https://gist.github.com/5554054.js?file=use_buy.erl"> </script>

<p>In the code above we compile our module and use spawn to start our purchase function in a lightweight process. spawn returns a process ID which we store in a variable. We can then use this variable to send messages to our process with ! syntax. This is an asynchronous example where a message is being sent and the system which sends the message is not waiting on a reply.</p>

<h2 id="synchronous-messaging">Synchronous Messaging</h2>

<p>Lets modify our functions to support synchronous messaging. The helper method purchase sends a message to the function purchase including a reference to itself so purchase can send a message back indicating it has printed the purchase.</p>

<noscript><pre>400: Invalid request
</pre></noscript>
<script src="https://gist.github.com/5554054.js?file=buy_sync.erl"> </script>

<h2 id="linking-processes-for-reliability">Linking Processes for Reliability</h2>

<p>Below we have a simple function which represents russian roulette. It accepts a number between 1 and 6 and if that number is three the process kills iteself. Any other number prints “click” and waits for the next message.</p>

<noscript><pre>400: Invalid request
</pre></noscript>
<script src="https://gist.github.com/5554054.js?file=roulette.erl"> </script>

<p>In the calling code above you can see that once the value 3 has been sent further calls to the roulette process do nothing as it is dead.</p>

<p>We can verify this using the following code.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>erlang:is_process_alive(Gun).
% returns false
</code></pre>
</div>

<p>We can create our own function to monitor a process and declare when it is dead. process_flag sets a flag on the process which calls the function to convert exit signals to {‘EXIT’, From, Reason} messages, which can be received as ordinary messages. We then define how to handle the messages we receive. For a normal message we link the coroner process to any process with a PID of Process and print out that we are monitoring the process. For exit messages we print out that the process has died and why.</p>

<noscript><pre>400: Invalid request
</pre></noscript>
<script src="https://gist.github.com/5554054.js?file=coroner.erl"> </script>

<p>We can improve on this further by creating a function that not only tells us when the process has died but then restarts it for us.When we receive a new message we spawn a roulette process and link it to our doctor process so the doctor process will get notified if it dies. We register the roulette processes id with the revolver atom. This allows us to send messages to the roulette process using revolver ! message without needing the PID. The exit handling has been enhanced to send a message to itself telling it to spawn a new game.</p>

<noscript><pre>400: Invalid request
</pre></noscript>
<script src="https://gist.github.com/5554054.js?file=doctor.erl"> </script>

<p>This is just a basic example to demonstrate how Erlang creates robust concurrent systems by providing libraries that make it easy to monitor processes, determine when they have crashed and restart them. As mentioned in previous blogs Erlang encourages you to ‘Let it crash’ rather than putting in lots of error handling.</p>

<h2 id="self-study">Self Study</h2>

<p>Open Telecom Platform (OTP) is a powerful package with much of what you’ll need to build a distributed, concurrent service.</p>

<h3 id="find">Find:</h3>

<p><em>An OTP service that will restart a process if it dies</em></p>

<p>http://www.erlang.org/doc/design_principles/sup_princ.html</p>

<p>http://www.hccp.org/supervisors.html</p>

<p><em>Documentation for building a simple OTP server</em></p>

<p>http://learnyousomeerlang.com/what-is-otp</p>

<p>http://20bits.com/article/erlang-a-generic-server-tutorial</p>

<h3 id="do">Do:</h3>

<ul>
  <li>Monitor the translate_service and restart it should it die.</li>
  <li>Make the Doctor process restart itself if it should die.</li>
  <li>Make a monitor for the Doctor monitor. If either monitor dies, restart it.</li>
</ul>

<p>The following bonus questions will take a little bit of research to complete:</p>

<ul>
  <li>Create a basic OTP server that logs messages to a file.</li>
  <li>Make the translate_service work across a network.</li>
</ul>

<p>Check out my code at <a href="https://github.com/heatherjc07/seven_languages_in_seven_days/tree/master/Erlang/Day2" target="_blank">github</a></p>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="http://localhost:4000/development/erlang-day-2/" class="btn" title="Erlang Day 2">Previous</a>
      
      
        <a href="http://localhost:4000/development/communication/" class="btn" title="Communication">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<span>&copy; 2017 Heather Campbell. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/so-simple-jekyll-theme/" rel="nofollow">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="https://twitter.com/hcampbell07" title="Heather Campbell on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	
	
	
	
	
	
	<a href="https://github.com/heatherjc07" title="Heather Campbell on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	
  
	
  <a href="http://localhost:4000/feed.xml" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = 'http://localhost:4000';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>




</body>
</html>
